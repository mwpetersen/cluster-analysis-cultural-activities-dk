---
title: "A K-means clustering analysis of cultural activities in a subset of Danish Municipalities"
subtitle: "Applied machine learning and big data, fall 2021"
author: "Mikkel Wittenburg Petersen"
date: "`r Sys.Date()`"
toc-title: Contents
output:
  pagedown::html_paged:
    toc: true
    number_sections: true
    css:
      - "../styles/fonts.css"
      - default
      - "../styles/custom-style.css"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(knitr)
library(tidyverse)
library(readxl)
library(readr)
library(clusterability)
library(factoextra)
library(NbClust)
library(mapDK)
library(janitor)

theme_set(theme_minimal())
```

```{r import-data}

df_cultural_activities <- read_excel("../data/use-of-cultural-activities-dk-2019.xlsx", skip = 2) %>%
  select(-1)

```

```{r wrangle data}

df_cultural_activities_clean <- df_cultural_activities %>%
  rename(municipality = `...2`) %>%
  filter(!str_detect(municipality, 'Region|Province')) %>%
  janitor::clean_names()

df_cultural_activities_all_numeric <- data.frame(df_cultural_activities_clean, row.names = 1)

df_cultural_activities_scaled <- as.data.frame(scale(df_cultural_activities_all_numeric))

```

# Introduction

This paper explores similarities and differences between Danish Municipalities in terms of cultural 
habits of their citizens. Which Municipalities are alike and which differ? And *how* are they similar or different? 

A common way to define different types of areas is to divide them into urban, suburban and
rural areas. Many analyses (see e.g. Pew Research Center, 2018) seek to explore whether there are systematic differences among these types of areas and communities — both politically, socially and culturally. In this paper I look at whether this division also emerges when looking at cultural
habits between citizens in primarily urban, suburban or rural Danish Municipalities.

The method I use to explore this is clustering. Specifically I use K-means and hierarchical
clustering to group Municipalities by the cultural habits of their citizens. Clustering 
is frequently used within the social sciences, especially in sociology (Ahlquist and Breunig, 2009).
Examples of the use of clustering within the social sciences are Chae (2010) who explore groups in political attitude, and Franzoni (2008) who explore groups of welfare regimes.  

The data is from a survey from 2019 by Statistics Denmark. In the survey they asked citizens in 44
Municipalities in Denmark about their use of cultural activities within the three months leading up to the survey. 

# Method
In this section I describe in detail how I explore similarities and differences between Danish Municipalities in terms of cultural habits of their citizens. Specifically, I describe the data and the methods used.

## The data
The data is from a Danish national survey from 2019 conducted by Statistics Denmark. Around 12.000
people aged 16 and up participated in the survey (Statistics Denmark, 2021:7). 

The purpose of the survey is to shed light on the cultural habits of the citizens of Denmark. Culture is in the survey defined in a broad sense and covers for instance concerts, theater, literature, cinema, exercise, computer games and other leisure activities. 

The participants in the survey were asked how often within the last three months leading up to the survey they had participated in for instance the cultural activities listed above. 

The data set used in this report is on an aggregated level. It shows for each municipality the percent of the adult population that had participated in the following cultural activities within the last three months leading up to the survey:

- `r colnames(df_cultural_activities)[2]`
- `r colnames(df_cultural_activities)[3]`
- `r colnames(df_cultural_activities)[4]`
- `r colnames(df_cultural_activities)[5]`
- `r colnames(df_cultural_activities)[6]`
- `r colnames(df_cultural_activities)[7]`
- `r colnames(df_cultural_activities)[8]`
- `r colnames(df_cultural_activities)[9]`
- `r colnames(df_cultural_activities)[10]`

Here's a look at the first five rows of the data set:
```{r}

knitr::kable(head(df_cultural_activities_clean[1:3], 3))

```


## K-means clustering and hierarchical clustering



# Analysis

## Choosing number of clusters

```{r}

nc <- NbClust(df_cultural_activities_scaled, min.nc=2, max.nc = 15, method = "kmeans")

fviz_nbclust(nc)

fviz_nbclust(df_cultural_activities_scaled, kmeans, method = "wss")


```

## Validation of the results

```{r k-means-clustering}

km_fit <- kmeans(df_cultural_activities_scaled, 3, nstart = 25)

test <- km_fit$cluster

df_cultural_activities_kmeans <- df_cultural_activities_scaled

df_cultural_activities_kmeans$cluster <- test

df_cultural_activities_kmeans %>%
  count(cluster)

df_cultural_activities_kmeans$kommune <- rownames(df_cultural_activities_scaled)  


```



## Visualize the results


### Bivariate cluster plot

Bivariate cluster plot
```{r}

fviz_cluster(km_fit, data = df_cultural_activities_scaled)

```


### Map of denmark with the clusters

```{r map-clusters}

mapDK(values = "cluster", id = "kommune", data = df_cultural_activities_kmeans)

```


## Interpret the results
## Validation of the results

### Are there clusters in the data?
```{r dip-test}

clusterabilitytest(df_cultural_activities_scaled, "dip")

```


# Discussion

# Literature

- Ahlquist, J. S. and Breunig, C. (2009): "Country clustering in comparative po-
litical economy". MPIfG Discussion Paper 09/5, Max-Planck-Institut für
Gesellschaftsforschung, Köln.

Chae, H. (2010): "South Korean attitudes toward the ROK−U.S. alliance: group
analysis". PS: Political Science and Politics 43, 493-501.

- Franzoni, J. M. (2008): "Welfare regimes in Latin America: capturing constella-
tions of markets, families, and policies". Latin American Politics and Society
50, 67-100.

- Pew Research Center (2018): “What Unites and Divides Urban, Suburban and Rural Communities”

- Statistics Denmark (2021): "Statistikdokumentation for Kulturvaneundersøgelsen 2021"
